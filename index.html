<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Retirex – Asesor Inteligente de Retiro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --magenta: #a0005a;
      --blue: #004b9a;
      --bg: #f4f4f7;
      --card: #ffffff;
      --text: #222;
      --bot: #f2e8f0;
      --user: #daf0ff;
      --radius: 14px;
    }

    body {
      margin:0;
      background: var(--bg);
      font-family: "Montserrat", sans-serif;
      display:flex;
      flex-direction:column;
      height:100vh;
    }

    /* HEADER */
    .header {
      background:white;
      padding:12px 20px;
      display:flex;
      align-items:center;
      gap:12px;
      box-shadow:0 2px 8px rgba(0,0,0,0.05);
    }

    .logo {
      width:40px;
      height:40px;
      border-radius:12px;
      background:linear-gradient(135deg, var(--magenta), var(--blue));
      display:flex;
      align-items:center;
      justify-content:center;
      color:white;
      font-weight:700;
      font-size:20px;
    }

    .title h1 {
      margin:0;
      font-size:18px;
      color: var(--magenta);
    }

    .title span {
      font-size:12px;
      color:#666;
    }

    /* CHAT AREA */
    .chat {
      flex:1;
      padding:20px;
      overflow-y:auto;
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .msg {
      max-width:80%;
      padding:12px 14px;
      border-radius: var(--radius);
      line-height:1.4;
      font-size:15px;
      white-space:pre-line;
    }

    .bot {
      background: var(--bot);
      align-self:flex-start;
    }

    .user {
      background: var(--user);
      align-self:flex-end;
    }

    /* MESSAGE COMPONENT FOR CARDS */
    .card {
      background:white;
      padding:14px;
      border-radius: var(--radius);
      box-shadow:0 4px 10px rgba(0,0,0,0.06);
      max-width:85%;
    }

    /* INPUT BAR */
    .input-bar {
      display:flex;
      padding:10px;
      background:white;
      box-shadow:0 -2px 8px rgba(0,0,0,0.05);
      gap:10px;
    }

    .input-bar input {
      flex:1;
      padding:12px;
      border-radius: var(--radius);
      border:1px solid #ccc;
      font-size:15px;
    }

    .input-bar button {
      background: var(--magenta);
      border:none;
      color:white;
      padding:0 20px;
      border-radius: var(--radius);
      font-weight:600;
      cursor:pointer;
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <div class="header">
    <div class="logo">R</div>
    <div class="title">
      <h1>Retirex</h1>
      <span>Asesor inteligente de retiro</span>
    </div>
  </div>

  <!-- CHAT -->
  <div id="chat" class="chat"></div>

  <!-- INPUT -->
  <div class="input-bar">
    <input id="userInput" placeholder="Escribí tu consulta..." />
    <button onclick="sendMessage()">Enviar</button>
  </div>


<script>
/* ------------------------------------------------------------------
                     SISTEMA DE CHAT
-------------------------------------------------------------------*/

const chat = document.getElementById("chat");

function addBot(msg) {
  const div = document.createElement("div");
  div.className = "msg bot";
  div.textContent = msg;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function addUser(msg) {
  const div = document.createElement("div");
  div.className = "msg user";
  div.textContent = msg;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

/* ------------------------------------------------------------------
              BASE DE RESPUESTAS INTERNAS (premium)
-------------------------------------------------------------------*/
const respuestasFijas = [
  {
    keywords:["funciona", "cómo funciona", "que es un plan", "que es un seguro"],
    answer:`Un plan de retiro de Prevención Retiro es una herramienta de ahorro a largo plazo. 
Vas aportando regularmente, el capital va creciendo y cuando llegás a la edad que elegís podés retirarlo. 
Está regulado por la Superintendencia de Seguros de la Nación y tiene el respaldo del Grupo Sancor Seguros.`
  },
  {
    keywords:["beneficio", "ventaja", "para que sirve"],
    answer:`Los planes de retiro ofrecen varios beneficios: ahorro sistemático, crecimiento en el tiempo, 
flexibilidad para ajustar aportes, posibilidad de rescate parcial o total y respaldo regulado. 
Es una forma de complementar tu futuro con claridad y control.`
  },
  {
    keywords:["diferencia", "oficial", "realista", "por qué hay dos", "escenario"],
    answer:`Cuando simulamos tu plan te muestro dos escenarios porque están calculados con dos metodologías distintas:

• Escenario oficial Prevención Retiro: es una proyección conservadora basada en la forma en que la compañía calcula el crecimiento del plan. Funciona como referencia prudente a largo plazo.

• Escenario realista: considera un rendimiento más alineado con lo que suele observarse hoy en instrumentos de ahorro a largo plazo.

La diferencia no es una elección, sino dos formas complementarias de ver cómo puede evolucionar tu aporte con el tiempo.`
  },
  {
    keywords:["pausar", "dejar de pagar", "suspender", "no puedo pagar", "no puedo seguir", "flexibilidad"],
    answer:`Tu plan puede adaptarse a vos: podés subir, bajar o incluso pausar los aportes cuando lo necesités. 
El capital que ya acumulaste sigue siendo tuyo. 
Los detalles dependen de la póliza, pero en general este tipo de planes contemplan esa flexibilidad.`
  },
  {
    keywords:["rescate", "retirar", "sacar plata"],
    answer:`Podés hacer rescates parciales o totales antes de la edad de retiro. 
Puede haber condiciones o ajustes definidos por la póliza, pero tus aportes siempre son tuyos. 
Lo ideal es ver tu caso puntual con el productor.`
  },
  {
    keywords:["seguro", "seguridad", "ssn", "regulado"],
    answer:`Prevención Retiro forma parte del Grupo Sancor Seguros y está regulada por la Superintendencia de Seguros de la Nación (inscripción 0930). 
Tu contrato está respaldado y sujeto a normativa clara.`
  },
  {
    keywords:["contratar", "quiero hacerlo", "avanzar", "quiero contratar"],
    answer:`Contratar el plan es simple: primero simulamos tu caso, definimos aporte y edad de retiro y después se formaliza. 
Trabajo junto a un productor matriculado que te acompaña paso a paso.`
  },
  {
    keywords:["edad", "mínimo", "aporte mínimo", "cuanto es el minimo"],
    answer:`El aporte mínimo actual para un plan individual es de $30.000 por mes. 
Desde ahí podés ajustarlo hacia arriba o hacia abajo según tu situación.`
  },
  {
    keywords:["para que sirve", "complemento", "jubilacion"],
    answer:`Este plan funciona como un complemento de tu futura jubilación. 
No reemplaza la prestación estatal, pero te ayuda a construir un ingreso adicional y previsible a largo plazo.`
  },
  {
    keywords:["adaptar", "personalizar", "compatible", "proyecto"],
    answer:`El plan está pensado para adaptarse a vos: podés modificar aportes, revisar la estrategia y ajustar la edad de retiro si tu situación cambia. 
Es una herramienta flexible, no rígida.`
  }
];

/* ------------------------------------------------------------------
                  DETECTOR DE INTENCIÓN
-------------------------------------------------------------------*/

function buscarRespuestaFija(texto) {
  const t = texto.toLowerCase();

  for (const item of respuestasFijas) {
    if (item.keywords.some(k => t.includes(k))) {
      return item.answer;
    }
  }
  return null;
}

/* ------------------------------------------------------------------
                ENVÍO DE MENSAJE DEL USUARIO
-------------------------------------------------------------------*/

async function sendMessage() {
  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if (!text) return;

  addUser(text);
  input.value = "";

  // 1) ¿Coincide con respuestas internas?
  const fija = buscarRespuestaFija(text);
  if (fija) {
    addBot(fija);
    return;
  }

  // 2) ¿Pide simulación?
  if (text.includes("simular") || text.includes("cotizar")) {
    mostrarFormularioSimulacion();
    return;
  }

  // 3) Si no es básico → IA
  const ia = await llamarIA(text);
  addBot(ia);
}


/* ------------------------------------------------------------------
                      LLAMADA A IA /ia
-------------------------------------------------------------------*/
async function llamarIA(texto) {
  try {
    const r = await fetch("https://retirex.onrender.com/ia", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        messages:[
          {role:"user", content:texto}
        ]
      })
    });

    const data = await r.json();
    return data.reply || "Puedo ayudarte con eso, ¿querés que lo veamos juntos?";
  } catch {
    return "Hubo un problema conectando con el módulo inteligente.";
  }
}

/* ------------------------------------------------------------------
                      FORMULARIO DE SIMULACIÓN
-------------------------------------------------------------------*/

function mostrarFormularioSimulacion() {
  const cont = document.createElement("div");
  cont.className = "card";
  cont.innerHTML = `
      <strong>Simulación rápida</strong>
      <br><br>
      <label>Edad actual</label>
      <input id="edad_actual" type="number" min="18" max="70"/>

      <label>Edad de retiro</label>
      <input id="edad_retiro" type="number" min="55" max="75"/>

      <label>Aporte mensual</label>
      <input id="aporte" type="number" min="30000" step="1000"/>

      <button onclick="enviarSimulador()">Calcular</button>
  `;
  chat.appendChild(cont);
  chat.scrollTop = chat.scrollHeight;
}

/* ------------------------------------------------------------------
                     LLAMADA A /cotizar
-------------------------------------------------------------------*/

async function enviarSimulador() {

  const edad_actual = Number(document.getElementById("edad_actual").value);
  const edad_retiro = Number(document.getElementById("edad_retiro").value);
  const aporte = Number(document.getElementById("aporte").value);

  addBot("Procesando simulación...");

  const r = await fetch("https://retirex.onrender.com/cotizar", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      edad_actual,
      edad_retiro,
      aporte_mensual: aporte,
      moneda:"pesos"
    })
  });

  const data = await r.json();

  mostrarResultados(data);
}

/* ------------------------------------------------------------------
                     MOSTRAR RESULTADOS Y GRÁFICO
-------------------------------------------------------------------*/

function mostrarResultados(data) {

  const card = document.createElement("div");
  card.className = "card";
  card.innerHTML = `
      <strong>Resultados de tu simulación:</strong>
      <br><br>
      Oficial Prevención: <b>$${data.oficial.capital.toLocaleString("es-AR")}</b><br>
      Realista (35% anual): <b>$${data.real_pesos.capital.toLocaleString("es-AR")}</b><br><br>
      <canvas id="chartSimulacion" height="200"></canvas>
  `;

  chat.appendChild(card);
  chat.scrollTop = chat.scrollHeight;

  setTimeout(() => dibujarGrafico(data), 150);

  setTimeout(() => {
    addBot(
      "Te explico por qué suele haber diferencia entre ambos escenarios: la estimación oficial usa una tasa muy conservadora, mientras que la realista refleja mejor cómo suele crecer un ahorro a largo plazo.\n\nSi querés ver cómo funciona el plan o qué beneficios tiene, preguntame."
    );
  }, 500);
}

/* ------------------------------------------------------------------
                         GRÁFICO
-------------------------------------------------------------------*/

function dibujarGrafico(data) {
  const ctx = document.getElementById("chartSimulacion").getContext("2d");

  new Chart(ctx, {
    type:"bar",
    data:{
      labels:["Oficial Prevención", "Realista"],
      datasets:[{
        data:[data.oficial.capital, data.real_pesos.capital],
        backgroundColor:["#A0005A", "#004B9A"],
        borderColor:["#7A0045", "#00356D"],
        borderWidth:2,
        barThickness:40
      }]
    },
    options:{
      plugins:{legend:{display:false}},
      scales:{
        y:{
          ticks:{color:"#333"},
          grid:{color:"#eee"}
        },
        x:{
          ticks:{color:"#333"},
          grid:{display:false}
        }
      }
    }
  });
}

/* ------------------------------------------------------------------
                         SALUDO INICIAL
-------------------------------------------------------------------*/
addBot("Hola, soy Retirex. Puedo ayudarte a entender cómo funcionan los planes de retiro y preparar una simulación para vos. ¿Qué te gustaría ver?");
</script>

</body>
</html>
