<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Retirex â€“ Chat Inteligente de Retiro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-68HDQMVBVX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-68HDQMVBVX');
  </script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --magenta:#a0005a;
      --blue:#004b9a;
      --bg:#e5e5e5;
      --chat-bg:#f2f2f7;
      --bubble-user:#d40077;
      --bubble-ai:#ffffff;
      --radius:16px;
    }
    body{margin:0;font-family:Montserrat,system-ui,sans-serif;background:var(--bg);display:flex;justify-content:center}
    .chat-container{width:100%;max-width:480px;height:100vh;background:var(--chat-bg);display:flex;flex-direction:column;padding-bottom:80px}
    .header{background:linear-gradient(135deg,var(--magenta),var(--blue));padding:14px;color:#fff;display:flex;gap:12px;font-weight:600}
    .avatar{width:38px;height:38px;background:#fff;color:var(--magenta);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700}
    .messages{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:14px}
    .msg{max-width:78%;padding:10px 14px;border-radius:var(--radius);font-size:14px;line-height:1.45}
    .ai{background:#fff;align-self:flex-start;border:1px solid rgba(0,0,0,.06);box-shadow:0 3px 10px rgba(0,0,0,.08)}
    .user{background:var(--bubble-user);color:#fff;align-self:flex-end}
    .input-area{position:fixed;bottom:0;width:100%;max-width:480px;background:#fff;padding:10px;display:flex;gap:10px;border-top:1px solid #ccc}
    .input-area input{flex:1;padding:10px;border-radius:var(--radius);border:1px solid #ddd}
    .input-area button{background:var(--magenta);color:#fff;border:none;border-radius:var(--radius);padding:0 16px;font-weight:600}
    .option-button{width:100%;padding:12px;background:#fff;border-radius:12px;border:1px solid #dcdcdc;margin-top:8px;text-align:left;font-weight:600;cursor:pointer}
    .info-block{display:none;background:#fff;border:1px solid #e5e5e5;border-radius:12px;padding:12px;font-size:13px}
    .chart-wrapper{background:#fff;padding:14px;border-radius:16px;border:1px solid #e5e5e5}
    .cta-whatsapp{margin-top:18px;padding:16px;background:#fff;border-radius:14px;border:1px solid #e3e3e3}
    .whatsapp-btn{background:#25D366;color:#fff;padding:10px 14px;border-radius:10px;font-weight:600;text-decoration:none;display:inline-block}
    .privacidad{font-size:11px;color:#6b6b6b;margin-top:8px}
  </style>
</head>

<body>
<div class="chat-container">
  <div class="header">
    <div class="avatar">R</div>
    Retirex â€“ Asesor inteligente
  </div>

  <div class="messages" id="messages"></div>

  <div class="input-area">
    <input id="userInput" placeholder="EscribÃ­ tu consulta..." />
    <button onclick="sendMessage()">Enviar</button>
  </div>
</div>

<script>
/* ================= UTIL ================= */
function addMessage(text, who="ai"){
  const d=document.createElement("div");
  d.className="msg "+who;
  d.innerHTML=text;
  document.getElementById("messages").appendChild(d);
  d.scrollIntoView({behavior:"smooth"});
}

function toggleBlock(id){
  const e=document.getElementById(id);
  if(e) e.style.display=e.style.display==="block"?"none":"block";
}
async function callAI(userMessage) {
  const systemPrompt = `
Sos Retirex, un asesor digital especializado en planes de retiro en Argentina,
en particular en planes de PrevenciÃ³n Retiro.

Reglas estrictas:
- RespondÃ© solo preguntas relacionadas con planes de retiro, ahorro previsional y simulaciones.
- No hables de inversiones financieras generales, crypto, polÃ­tica ni temas ajenos.
- No prometas rendimientos ni inventes nÃºmeros.
- UsÃ¡ un lenguaje claro, humano y prudente.
- Si la pregunta no corresponde, redirigÃ­ con educaciÃ³n.
- CerrÃ¡ siempre con una invitaciÃ³n suave a simular o continuar el anÃ¡lisis.
`;

  try {
    const response = await fetch("https://retirex.onrender.com/ia", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        messages: [
          { role: "system", content: systemPrompt },
          { role: "user", content: userMessage }
        ]
      })
    });

    const data = await response.json();
    return data?.reply || "Si querÃ©s, puedo ayudarte a verlo con una simulaciÃ³n ğŸ˜Š";
  } catch (error) {
    return "Ahora mismo no puedo responder esa consulta. Si querÃ©s, seguimos con una simulaciÃ³n.";
  }
}
/* ================= BIENVENIDA ================= */
function sendWelcome(){
  addMessage(`
    Hola ğŸ‘‹ soy <strong>Retirex</strong>, tu asistente digital especializado en los planes de retiro de PrevenciÃ³n Retiro.<br><br>
    Â¿QuÃ© te gustarÃ­a hacer hoy?
  `);

  addMessage(`
    <button class="option-button" onclick="startSimulation()">ğŸ§® Simular mi plan</button>
    <button class="option-button" onclick="showFAQ()">ğŸ’¬ Dudas frecuentes</button>
  `);
}

/* ================= DUDAS FRECUENTES (BLOQUES COMPLETOS) ================= */
function showFAQ(){
  addMessage(`
    <strong>Dudas frecuentes</strong><br><br>

    <button class="option-button" onclick="toggleBlock('faq1')">ğŸ§  Â¿QuÃ© es un plan de retiro y cÃ³mo funciona?</button>
   <div id="faq1" class="info-block">
  Un plan de retiro es un ahorro de largo plazo regulado por la
  <strong>Superintendencia de Seguros de la NaciÃ³n</strong>.<br><br>

  Funciona de forma simple y previsible:<br><br>

  1ï¸âƒ£ AportÃ¡s todos los meses un monto que elegÃ­s.<br>
  2ï¸âƒ£ Ese dinero se invierte y se capitaliza con el paso del tiempo.<br>
  3ï¸âƒ£ Al llegar a la edad de retiro, contÃ¡s con un capital acumulado
  para complementar tu jubilaciÃ³n.<br><br>

  No es un plazo fijo ni una inversiÃ³n especulativa.<br>
  EstÃ¡ pensado para aprovechar el <strong>tiempo</strong>,
  que es el factor mÃ¡s importante en este tipo de ahorro.
</div>

    <button class="option-button" onclick="toggleBlock('faq2')">â³ La importancia del tiempo</button>
    <div id="faq2" class="info-block">
  En los planes de retiro, el <strong>tiempo</strong> es mÃ¡s importante
  que el monto inicial.<br><br>

  Aportar un poco durante muchos aÃ±os suele generar mÃ¡s capital
  que aportar mucho durante pocos aÃ±os.<br><br>

  Esto sucede porque:<br>
  â€¢ El dinero se capitaliza mes a mes.<br>
  â€¢ Los intereses se reinvierten.<br>
  â€¢ Cada aÃ±o adicional potencia al anterior.<br><br>

  Por eso, empezar antes â€”aunque sea con un aporte moderadoâ€”
  suele marcar una gran diferencia en el resultado final.
</div>

    <button class="option-button" onclick="toggleBlock('faq3')">ğŸ”„ Flexibilidad</button>
    <div id="faq3" class="info-block">
  Uno de los puntos mÃ¡s fuertes de los planes de retiro
  es la <strong>flexibilidad</strong>.<br><br>

  A lo largo del tiempo podÃ©s:<br>
  â€¢ Subir tu aporte cuando tus ingresos mejoran.<br>
  â€¢ Bajarlo si atravesÃ¡s un perÃ­odo mÃ¡s ajustado.<br>
  â€¢ Pausar aportes por un tiempo sin perder lo ya acumulado.<br>
  â€¢ Hacer aportes extraordinarios cuando te convenga.<br><br>

  El plan se adapta a tu realidad, no al revÃ©s.
</div>
<button class="option-button" onclick="toggleBlock('faq4')">
  ğŸ§˜â€â™‚ï¸ Â¿QuÃ© pasa si no puedo pagar por un tiempo?
</button>

<div id="faq4" class="info-block">
  Es una situaciÃ³n comÃºn y estÃ¡ contemplada en este tipo de planes.<br><br>

  Si en algÃºn momento no podÃ©s pagar:<br>
  â€¢ PodÃ©s reducir el aporte.<br>
  â€¢ PodÃ©s pausar los aportes por un perÃ­odo.<br>
  â€¢ El capital ya acumulado sigue siendo <strong>tuyo</strong>.<br><br>

  No perdÃ©s el plan ni lo construido hasta ese momento.
</div>

<button class="option-button" onclick="toggleBlock('faq5')">
  ğŸ’° Rescates: Â¿se puede retirar dinero antes?
</button>

<div id="faq5" class="info-block">
  Los planes de retiro permiten rescates anticipados,
  pero estÃ¡n pensados para el largo plazo.<br><br>

  Por eso, los rescates pueden tener ajustes que dependen de:<br>
  â€¢ El momento en que se realicen.<br>
  â€¢ El tiempo que lleve el plan.<br>
  â€¢ Las condiciones especÃ­ficas de la pÃ³liza.<br><br>

  No es una cuenta corriente.<br>
  Es un ahorro con objetivo.
</div>

  `);
}

/* ================= SIMULADOR ================= */
let flow={step:0};

function startSimulation(){
  flow={step:1};
  addMessage("Perfecto ğŸ˜Š Para empezar, Â¿cuÃ¡l es tu sexo? (M/F)");
}

async function sendMessage() {
  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if (!text) return;

  addMessage(text, "user");
  input.value = "";

  // ğŸ”´ SI ESTAMOS EN FLUJO GUIADO â†’ MANDA A handleFlow
  if (flow.step > 0) {
    handleFlow(text);
    return;
  }

  // ğŸ”¹ RESPUESTAS FIJAS
  const fixed = checkFixedResponses(text);
  if (fixed) {
    addMessage(fixed);
    return;
  }

  // ğŸ”µ FALLBACK IA (OpenAI)
  addMessage("Dame un segundo...", "ai");
  const aiReply = await callAI(text);
  addMessage(aiReply);
}

function handleFlow(msg){
  if (flow.step === 1) {
  const s = msg.trim().toUpperCase();

  if (s !== "M" && s !== "F") {
    addMessage("Para continuar necesito que ingreses **M** o **F** ğŸ˜Š");
    return; // ğŸ”´ NO AVANZA
  }

  flow.sexo = s;
  flow.step = 2;
  addMessage("Genial ğŸ‘ Â¿CuÃ¡l es tu edad actual?");
  return;
}
  if (flow.step === 2) {
  const edad = Number(msg);

  if (isNaN(edad) || edad < 18 || edad > 70) {
    addMessage("IngresÃ¡ una edad vÃ¡lida entre **18 y 70 aÃ±os** ğŸ˜Š");
    return; // ğŸ”´ NO AVANZA
  }

  flow.edad = edad;
  flow.step = 3;
  addMessage("Â¿A quÃ© edad te gustarÃ­a retirarte?");
  return;
}
  if (flow.step === 3) {
  const retiro = Number(msg);
  const minRetiro = flow.edad + 5;

  if (isNaN(retiro) || retiro < minRetiro || retiro > 85) {
    addMessage(
      `ElegÃ­ una edad de retiro vÃ¡lida ğŸ˜Š<br>
       ğŸ‘‰ MÃ­nimo: ${minRetiro} aÃ±os<br>
       ğŸ‘‰ MÃ¡ximo: 85 aÃ±os`
    );
    return; // ğŸ”´ NO AVANZA
  }

  flow.retiro = retiro;
  flow.step = 4;
  addMessage("Perfecto ğŸ™Œ Â¿CuÃ¡nto querÃ©s aportar por mes?");
  return;
}
  if (flow.step === 4) {
  const aporte = Number(msg);

  if (isNaN(aporte) || aporte < 30000) {
    addMessage("El aporte mÃ­nimo del plan es **$30.000 por mes** ğŸ˜Š");
    return; // ğŸ”´ NO AVANZA
  }

  flow.aporte = aporte;
  flow.step = 0;
  runSimulation();
  return;
}
}

async function runSimulation(){
  const {sexo,edad,retiro,aporte}=flow;
  addMessage("Calculando tu simulaciÃ³n... â³");

  const r=await fetch("https://retirex.onrender.com/cotizar",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({sexo,edad_actual:edad,edad_retiro:retiro,aporte_mensual:aporte})
  });

  const data=await r.json();
  const oficial=data.oficial.capital;
  const realista=data.realista.capital;

  addMessage(`
    <strong>Resultados listos ğŸ‰</strong><br><br>
    <strong>Escenario oficial:</strong><br>$${oficial.toLocaleString("es-AR")}<br><br>
    <strong>Escenario realista:</strong><br>$${realista.toLocaleString("es-AR")}<br><br>
   ğŸ” Por quÃ© la diferencia es tan grande

Ambos escenarios usan el mismo perÃ­odo de tiempo y el mismo esfuerzo de ahorro.

La diferencia no estÃ¡ en cuÃ¡nto tiempo pasa,
sino en cÃ³mo ese tiempo amplifica distintos supuestos de crecimiento a lo largo de los aÃ±os.

Al comienzo, la brecha es pequeÃ±a.
Con el paso del tiempo, esa diferencia se va acumulando y se hace mÃ¡s visible,
especialmente en los tramos finales del plan.

ğŸ‘‰ No es una elecciÃ³n entre uno u otro.
Es una forma de entender cÃ³mo el largo plazo potencia los resultados.
  `);

  const chartId="chart"+Date.now();
  addMessage(`
    <div class="chart-wrapper">
      <strong>ComparaciÃ³n grÃ¡fica</strong><br><br>
      <canvas id="${chartId}" height="160"></canvas>
    </div>
  `);

  setTimeout(()=>{
    new Chart(document.getElementById(chartId),{
      type:"bar",
      data:{labels:["Oficial","Realista"],datasets:[{data:[oficial,realista],backgroundColor:["#a0005a","#004b9a"],borderRadius:10}]},
      options:{plugins:{legend:{display:false}}}
    });
  },200);

  addMessage(`
    <div style="font-size:12px;color:#666;">
      <strong>Importante:</strong> SimulaciÃ³n orientativa. No constituye garantÃ­a de rendimiento futuro.
    </div>
  `);

  /* ===== BLOQUES POST-COTIZACIÃ“N ===== */
  addMessage(`
    <strong>Antes de seguir, una breve guÃ­a ğŸ‘‡</strong>

    <button class="option-button" onclick="toggleBlock('post1')">ğŸ§  CÃ³mo leer estos resultados</button>
   <div id="post1" class="info-block">
  Esta simulaciÃ³n muestra <strong>dos escenarios distintos</strong> porque un ahorro de largo plazo no se puede analizar con una sola cifra.<br><br>

  ğŸ”¹ <strong>Escenario Oficial</strong><br>
  Es una simulaciÃ³n estimada por la compaÃ±Ã­a, construida bajo criterios conservadores.<br>
  No es un piso, ni una promesa, ni un mÃ­nimo garantizado.<br>
  Sirve para mostrar cÃ³mo podrÃ­a evolucionar el plan bajo supuestos prudentes.<br><br>

  ğŸ”¹ <strong>Escenario Realista</strong><br>
  Refleja un crecimiento mÃ¡s alineado con la lÃ³gica del largo plazo en Argentina.<br>
  Tiene en cuenta una dinÃ¡mica mÃ¡s cercana a la evoluciÃ³n histÃ³rica de los fondos en pesos.<br><br>

  ğŸ‘‰ No tenÃ©s que elegir uno u otro.<br>
  Los dos existen para que entiendas el <strong>rango posible</strong> en el que puede moverse tu ahorro a lo largo del tiempo.
</div>

    <button class="option-button" onclick="toggleBlock('post2')">ğŸ›¡ï¸ QuÃ© tan seguro es este plan</button>
    <div id="post2" class="info-block">
  Este plan de retiro es un producto de <strong>PrevenciÃ³n Retiro</strong>, compaÃ±Ã­a especializada en seguros de retiro,<br>
  y forma parte del <strong>Grupo Sancor Seguros</strong>, el grupo asegurador lÃ­der del mercado argentino.<br><br>

  Funciona bajo un esquema de <strong>capitalizaciÃ³n individual</strong>, regulado por la
  <strong>Superintendencia de Seguros de la NaciÃ³n</strong>.<br><br>

  âœ”ï¸ Tu ahorro se registra a tu nombre<br>
  âœ”ï¸ No se mezcla con el de otros asegurados<br>
  âœ”ï¸ EstÃ¡ administrado bajo normas estrictas de control y solvencia<br><br>

  ğŸ”’ <strong>Punto clave que pocos conocen</strong><br>
  <strong>Rendimiento tÃ©cnico garantizado en pesos</strong><br><br>

  El plan cuenta con un <strong>rendimiento tÃ©cnico garantizado del 4 % anual en pesos</strong>.<br>
  Esto implica que, incluso en escenarios econÃ³micos adversos:<br><br>

  ğŸ‘‰ El capital aportado no puede disminuir<br>
  ğŸ‘‰ Nunca podrÃ­as perder el dinero que aportaste al plan<br><br>

  La simulaciÃ³n muestra escenarios posibles de crecimiento.<br>
  La garantÃ­a actÃºa como un <strong>respaldo real del capital base</strong>.<br><br>

  Por eso, un seguro de retiro se diferencia de otros instrumentos financieros:
  combina <strong>proyecciÃ³n de crecimiento</strong> con <strong>protecciÃ³n del ahorro</strong>.
</div>

    <button class="option-button" onclick="toggleBlock('post3')">ğŸ”„ QuÃ© pasa si mi situaciÃ³n cambia</button>
    <div id="post3" class="info-block">
  La vida cambia. Tu plan tambiÃ©n puede hacerlo.<br><br>

  Este tipo de plan no es rÃ­gido ni cerrado.<br>
  EstÃ¡ pensado para acompaÃ±arte en el tiempo.<br><br>

  âœ”ï¸ PodÃ©s subir o bajar el aporte segÃºn tus ingresos<br>
  âœ”ï¸ PodÃ©s pausar los aportes si lo necesitÃ¡s<br>
  âœ”ï¸ PodÃ©s hacer aportes extraordinarios cuando te convenga<br>
  âœ”ï¸ Existen opciones de rescate, segÃºn la etapa del plan<br><br>

  El objetivo no es exigirte todos los meses,<br>
  sino <strong>adaptarse a tu realidad</strong>, incluso cuando las cosas cambian.
</div>

  `);

  const wsp=encodeURIComponent(
`Hola, quiero avanzar con mi plan de retiro.

Datos de mi simulaciÃ³n:
Sexo: ${sexo}
Edad actual: ${edad}
Edad retiro: ${retiro}
Aporte mensual: $${aporte.toLocaleString("es-AR")}

Escenario oficial: $${oficial.toLocaleString("es-AR")}
Escenario realista: $${realista.toLocaleString("es-AR")}
`);

  addMessage(`
    <div class="cta-whatsapp">
      <a class="whatsapp-btn" href="https://wa.me/5492804866612?text=${wsp}" target="_blank">
        ğŸ“² Hablar con un asesor
      </a>
      <p class="privacidad">Sin spam. Solo asesoramiento real.</p>
    </div>
  `);
}

window.onload=sendWelcome;
</script>

</body>
</html>
