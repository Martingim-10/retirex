<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Retirex â€“ Asesor Inteligente de Retiro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-68HDQMVBVX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-68HDQMVBVX');
  </script>

  <style>
    :root {
      --magenta:#a0005a;
      --blue:#004b9a;
      --bg:#e5e5e5;
      --chat-bg:#f2f2f7;
      --bubble-user:#d40077;
      --bubble-ai:#ffffff;
      --radius:16px;
    }

    body {
      margin: 0;
      font-family: 'Montserrat', sans-serif;
      background: var(--bg);
      display: flex;
      justify-content: center;
    }

    .chat-container{
      width:100%;
      max-width:480px;
      height:100vh;
      background:var(--chat-bg);
      display:flex;
      flex-direction:column;
      padding-bottom:80px;
    }

    .header{
      background:linear-gradient(135deg,var(--magenta),var(--blue));
      padding:14px;
      color:#fff;
      display:flex;
      gap:12px;
      font-weight:600;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1)
    }

    .avatar{
      width:38px;height:38px;
      background:#fff;
      color:var(--magenta);
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700
    }

    .messages{
      flex:1;
      overflow-y:auto;
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:14px
    }

    .msg{
      max-width:85%;
      padding:12px 16px;
      border-radius:16px;
      font-size:14px;
      line-height:1.45;
      animation: fadeIn .3s ease;
      word-wrap: break-word;
    }

    @keyframes fadeIn {
      from { opacity:0; transform:translateY(10px); }
      to { opacity:1; transform:translateY(0); }
    }

    .ai{
      background:#fff;
      align-self:flex-start;
      border:1px solid rgba(0,0,0,.06);
      box-shadow:0 3px 10px rgba(0,0,0,.08)
    }

    .user{
      background:var(--bubble-user);
      color:#fff;
      align-self:flex-end
    }

    .visual-options{
      display:flex;
      flex-direction:column;
      gap:12px;
      margin-top:10px;
    }

    .card-option{
      background:#fff;
      border:1px solid #e0e0e0;
      border-radius:16px;
      padding:16px;
      cursor:pointer;
      transition:.2s;
      box-shadow:0 2px 6px rgba(0,0,0,.05)
    }

    .card-option:hover{
      border-color:var(--magenta);
      transform:translateY(-2px);
      box-shadow:0 4px 12px rgba(0,0,0,.1)
    }

    .card-option span{font-size:24px;display:block;margin-bottom:8px}
    .card-option strong{color:var(--blue);font-size:15px}
    .card-option p{font-size:12px;color:#666;margin:0}

    .input-area{
      position:fixed;
      bottom:0;
      width:100%;
      max-width:480px;
      background:#fff;
      padding:12px;
      display:flex;
      gap:10px;
      border-top:1px solid #ccc;
    }

    .input-area input{
      flex:1;
      padding:12px;
      border-radius:16px;
      border:1px solid #ddd;
      font-size:14px;
      outline:none
    }

    .input-area button{
      background:var(--magenta);
      color:#fff;
      border:none;
      border-radius:16px;
      padding:0 20px;
      font-weight:600;
      cursor:pointer
    }

    .analysis-card{
      background:#fff;
      border-left:5px solid var(--magenta);
      padding:15px;
      border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,.08)
    }

    .option-button{
      width:100%;
      padding:14px;
      background:#fff;
      border-radius:14px;
      border:1px solid #dcdcdc;
      margin-top:10px;
      text-align:left;
      font-weight:600;
      font-size:15px;
      cursor:pointer;
    }

    .info-block{
      display:none;
      background:#f8f9fa;
      border:1px solid #e5e5e5;
      border-radius:14px;
      padding:16px;
      font-size:15px;
      line-height:1.6;
      margin-top:8px;
    }

    .cta-whatsapp{
      margin-top:18px;
      padding:16px;
      background:#fff;
      border-radius:14px;
      border:1px solid #e3e3e3;
      text-align:center;
    }

    .whatsapp-btn{
      background:#25D366;
      color:#fff;
      padding:12px 20px;
      border-radius:10px;
      font-weight:600;
      text-decoration:none;
      display:inline-block
    }

    .privacidad{
      font-size:11px;
      color:#6b6b6b;
      margin-top:8px
    }
  </style>
</head>

<body>
<div class="chat-container">
  <div class="header">
    <div class="avatar">R</div>
    Retirex â€“ Asesor Inteligente
  </div>

  <div class="messages" id="messages"></div>

  <div class="input-area">
    <input id="userInput" placeholder="EscribÃ­ tu consulta..." autocomplete="off" />
    <button onclick="sendMessage()">Enviar</button>
  </div>
</div>

<script>
let flow = { step: 0 };

function addMessage(text, who="ai") {
  const d = document.createElement("div");
  d.className = "msg " + who;
  d.innerHTML = text;
  document.getElementById("messages").appendChild(d);
  d.scrollIntoView({ behavior: "smooth" });
}

function toggleBlock(id){
  const e=document.getElementById(id);
  if(e) e.style.display = e.style.display === "block" ? "none" : "block";
}

function generateAnalysis(edad, retiro, aporte) {
  const aÃ±os = retiro - edad;

  if (aÃ±os >= 25) {
    return `<strong>AnÃ¡lisis Retirex: el poder del tiempo</strong><br>
    TenÃ©s <strong>${aÃ±os} aÃ±os</strong> por delante. El interÃ©s compuesto trabaja a tu favor y multiplica cada aporte.`;
  }

  if (aÃ±os < 20 && aporte >= 80000) {
    return `<strong>AnÃ¡lisis Retirex: foco en intensidad</strong><br>
    Tu nivel de aporte compensa el menor horizonte. EstÃ¡s construyendo capital de forma sÃ³lida.`;
  }

  if (aÃ±os < 15) {
    return `<strong>AnÃ¡lisis Retirex: estrategia consciente</strong><br>
    El tiempo es mÃ¡s corto, pero la constancia y los refuerzos pueden marcar una gran diferencia.`;
  }

  return `<strong>AnÃ¡lisis Retirex: equilibrio saludable</strong><br>
  Tu edad y aporte muestran una estrategia consistente para construir respaldo futuro.`;
}

function sendWelcome() {
  addMessage(`Hola ğŸ‘‹ soy <strong>Retirex</strong>, tu asesor digital de PrevenciÃ³n Retiro.<br><br>Â¿En quÃ© etapa de tu futuro te gustarÃ­a enfocarte hoy?`);

  addMessage(`
    <div class="visual-options">
      <div class="card-option" onclick="startSimulation('Independencia')">
        <span>ğŸï¸</span>
        <strong>Independencia Retiro</strong>
        <p>ProyectÃ¡ un futuro con libertad financiera.</p>
      </div>
      <div class="card-option" onclick="startSimulation('ProtecciÃ³n')">
        <span>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
        <strong>ProtecciÃ³n Familiar</strong>
        <p>AsegurÃ¡ el futuro de los que mÃ¡s querÃ©s.</p>
      </div>
      <div class="card-option" onclick="showFAQ()">
        <span>ğŸ’¬</span>
        <strong>Dudas frecuentes</strong>
        <p>Seguridad, rescates y garantÃ­as.</p>
      </div>
    </div>
  `);
}

function showFAQ() {
  addMessage(`
    <strong>Dudas frecuentes</strong><br><br>

    <button class="option-button" onclick="toggleBlock('faq1')">ğŸ§  Â¿QuÃ© es un plan de retiro?</button>
    <div id="faq1" class="info-block">
      Es un ahorro de largo plazo regulado por la Superintendencia de Seguros de la NaciÃ³n.
      Complementa tu jubilaciÃ³n y te permite construir capital propio.
    </div>

    <button class="option-button" onclick="toggleBlock('faq2')">ğŸ›¡ï¸ Â¿QuÃ© tan seguro es?</button>
    <div id="faq2" class="info-block">
      Producto de PrevenciÃ³n Retiro (Grupo Sancor Seguros). CapitalizaciÃ³n individual,
      rendimiento tÃ©cnico garantizado y control estatal.
    </div>

    <button class="option-button" onclick="toggleBlock('faq3')">ğŸ”„ Â¿Puedo cambiar el aporte?</button>
    <div id="faq3" class="info-block">
      SÃ­. PodÃ©s aumentarlo, reducirlo o pausarlo segÃºn tu situaciÃ³n.
    </div>

    <button class="option-button" onclick="toggleBlock('faq4')">ğŸ’° Â¿Puedo retirar antes?</button>
    <div id="faq4" class="info-block">
      Existen rescates anticipados segÃºn condiciones del plan.
      EstÃ¡ pensado como ahorro de largo plazo.
    </div>

    <br>
    <button class="option-button" onclick="startSimulation()">
      ğŸ§® Simular mi plan
    </button>
  `);
}

function startSimulation(meta){
  flow = { step: 1, meta };
  addMessage(`Perfecto. Vamos a calcularlo.<br><br>Â¿CuÃ¡l es tu sexo? (M/F)`);
}

function sendMessage() {
  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if (!text) return;

  addMessage(text, "user");
  input.value = "";

  if (flow.step > 0) {
    handleFlow(text);
    return;
  }

  addMessage("Podemos iniciar una simulaciÃ³n si querÃ©s ğŸ˜Š");
}

function handleFlow(msg) {
  if (flow.step === 1) {
    const s = msg.toUpperCase();
    if (s !== "M" && s !== "F") return addMessage("IngresÃ¡ M o F");
    flow.sexo = s;
    flow.step = 2;
    addMessage("Â¿CuÃ¡l es tu edad actual?");
    return;
  }

  if (flow.step === 2) {
    const e = Number(msg);
    if (isNaN(e) || e < 18 || e > 70) return addMessage("IngresÃ¡ una edad vÃ¡lida entre 18 y 70");
    flow.edad = e;
    flow.step = 3;
    addMessage("Â¿A quÃ© edad te gustarÃ­a retirarte?");
    return;
  }

  if (flow.step === 3) {
    const r = Number(msg);
    if (isNaN(r) || r < flow.edad + 5 || r > 85)
      return addMessage(`Debe ser mayor a ${flow.edad + 5}`);
    flow.retiro = r;
    flow.step = 4;
    addMessage("Â¿CuÃ¡nto querÃ©s aportar por mes? (mÃ­nimo $40.000)");
    return;
  }

  if (flow.step === 4) {
    const a = Number(msg);
    if (isNaN(a) || a < 40000)
      return addMessage("El aporte mÃ­nimo es $40.000");
    flow.aporte = a;
    flow.step = 0;
    runSimulation();
  }
}

/* ================== SIMULACIÃ“N ================== */
async function runSimulation() {
  const { sexo, edad, retiro, aporte } = flow;

  addMessage("Calculando tu simulaciÃ³n... â³");

  const analysis = generateAnalysis(edad, retiro, aporte);
  addMessage(`<div class="analysis-card">${analysis}</div>`);

  try {
    const r = await fetch("https://retirex-api-v1-571092083944.us-east1.run.app/cotizar", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ sexo, edad_actual: edad, edad_retiro: retiro, aporte_mensual: aporte })
    });

    const data = await r.json();
    const oficial = data.oficial.capital;
    const realista = data.realista.capital;

    addMessage(`
      <strong>Resultado de tu simulaciÃ³n</strong><br><br>
      <strong>Escenario oficial:</strong><br>$${oficial.toLocaleString("es-AR")}<br><br>
      <strong style="font-size:18px;color:#004b9a">Escenario realista:</strong><br>
      <strong style="font-size:22px;color:#004b9a">$${realista.toLocaleString("es-AR")}</strong>
    `);

    addMessage(`
      <div style="font-size:12px;color:#666;margin-top:6px;">
        SimulaciÃ³n orientativa. No constituye garantÃ­a de rendimiento futuro.
      </div>
    `);

    addMessage(`
      <strong>Antes de seguir, una breve guÃ­a ğŸ‘‡</strong>

      <button class="option-button" onclick="toggleBlock('post1')">ğŸ§  CÃ³mo leer estos resultados</button>
      <div id="post1" class="info-block">
        Los valores muestran escenarios posibles. El objetivo es ayudarte a entender el impacto del tiempo y el ahorro.
      </div>

      <button class="option-button" onclick="toggleBlock('post2')">ğŸ›¡ï¸ QuÃ© tan seguro es este plan</button>
      <div id="post2" class="info-block">
        Producto de PrevenciÃ³n Retiro (Grupo Sancor Seguros), regulado por la SSN y con capitalizaciÃ³n individual.
      </div>

      <button class="option-button" onclick="toggleBlock('post3')">ğŸ”„ QuÃ© pasa si mi situaciÃ³n cambia</button>
      <div id="post3" class="info-block">
        PodÃ©s modificar aportes, pausarlos o reforzarlos segÃºn tu momento.
      </div>
    `);

    const wsp = encodeURIComponent(
      `Hola, quiero avanzar con mi plan. Edad: ${edad}. Aporte: $${aporte}. Escenario realista: $${realista.toLocaleString("es-AR")}`
    );

    addMessage(`
      <div class="cta-whatsapp">
        <a class="whatsapp-btn" href="https://wa.me/5492804866612?text=${wsp}" target="_blank">
          ğŸ“² Hablar con un asesor
        </a>
        <p class="privacidad">Sin spam. Solo asesoramiento real.</p>
      </div>
    `);

  } catch (e) {
    addMessage("Error de conexiÃ³n. IntentÃ¡ nuevamente.");
  }
}

window.onload = sendWelcome;
document.getElementById("userInput").addEventListener("keydown", e => {
  if (e.key === "Enter") {
    e.preventDefault();
    sendMessage();
  }
});
</script>
</body>
</html>