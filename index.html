<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Retirex ‚Äì Asesor Inteligente de Retiro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-68HDQMVBVX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-68HDQMVBVX');
  </script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --magenta:#a0005a;
      --blue:#004b9a;
      --bg:#e5e5e5;
      --chat-bg:#f2f2f7;
      --bubble-user:#d40077;
      --bubble-ai:#ffffff;
      --radius:16px;
    }

    body {
      margin:0;
      font-family:Montserrat, system-ui, sans-serif;
      background:var(--bg);
      display:flex;
      justify-content:center;
    }

    .chat-container {
      width:100%;
      max-width:480px;
      height:100vh;
      background:var(--chat-bg);
      display:flex;
      flex-direction:column;
      padding-bottom:80px;
    }

    .header {
      background:linear-gradient(135deg,var(--magenta),var(--blue));
      padding:14px;
      color:white;
      display:flex;
      align-items:center;
      gap:12px;
      font-weight:600;
    }

    .avatar {
      width:38px;
      height:38px;
      background:white;
      color:var(--magenta);
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
    }

    .messages {
      flex:1;
      overflow-y:auto;
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .msg {
      max-width:78%;
      padding:10px 14px;
      border-radius:var(--radius);
      font-size:14px;
      line-height:1.45;
    }

    .ai {
      background:var(--bubble-ai);
      align-self:flex-start;
      border:1px solid rgba(0,0,0,.06);
      box-shadow:0 3px 10px rgba(0,0,0,.08);
    }

    .user {
      background:var(--bubble-user);
      color:white;
      align-self:flex-end;
    }

    .input-area {
      position:fixed;
      bottom:0;
      width:100%;
      max-width:480px;
      background:white;
      padding:10px;
      display:flex;
      gap:10px;
      border-top:1px solid #ccc;
    }

    .input-area input {
      flex:1;
      padding:10px;
      border-radius:var(--radius);
      border:1px solid #ddd;
    }

    .input-area button {
      background:var(--magenta);
      color:white;
      border:none;
      border-radius:var(--radius);
      padding:0 16px;
      font-weight:600;
      cursor:pointer;
    }

    .option-button {
      width:100%;
      padding:12px;
      background:white;
      border-radius:12px;
      border:1px solid #dcdcdc;
      margin-top:8px;
      cursor:pointer;
      text-align:left;
      font-weight:600;
    }

    .info-block {
      display:none;
      background:white;
      border:1px solid #e5e5e5;
      border-radius:12px;
      padding:12px;
      margin-top:6px;
      font-size:13px;
      line-height:1.45;
    }

    .chart-wrapper {
      background:white;
      padding:14px;
      border-radius:16px;
      box-shadow:0 2px 12px rgba(0,0,0,.08);
      border:1px solid #e5e5e5;
    }

    .cta-whatsapp {
      margin-top:18px;
      padding:16px;
      background:white;
      border-radius:14px;
      border:1px solid #e3e3e3;
    }

    .whatsapp-btn {
      background:#25D366;
      color:white;
      padding:10px 14px;
      border-radius:10px;
      font-weight:600;
      text-decoration:none;
      display:inline-block;
      margin-top:8px;
    }

    .privacidad {
      font-size:11px;
      color:#6b6b6b;
      margin-top:8px;
    }
  </style>
</head>

<body>
<div class="chat-container">
  <div class="header">
    <div class="avatar">R</div>
    Retirex ‚Äì Asesor inteligente
  </div>

  <div class="messages" id="messages"></div>

  <div class="input-area">
    <input id="userInput" placeholder="Escrib√≠ tu consulta‚Ä¶" />
    <button onclick="sendMessage()">Enviar</button>
  </div>
</div>

<script>
/* ================= UTIL ================= */
function addMessage(text, who="ai"){
  const d=document.createElement("div");
  d.className="msg "+who;
  d.innerHTML=text;
  document.getElementById("messages").appendChild(d);
  d.scrollIntoView({behavior:"smooth"});
}

function toggleBlock(id){
  const e=document.getElementById(id);
  if(e) e.style.display=e.style.display==="block"?"none":"block";
}

/* ================= BIENVENIDA ================= */
window.onload=()=>{
  addMessage(`Hola üëã soy <strong>Retirex</strong>, tu asistente digital especializado en planes de retiro.<br><br>¬øQu√© te gustar√≠a hacer hoy?`);
  addMessage(`
    <button class="option-button" onclick="startSimulation()">üßÆ Simular mi plan</button>
    <button class="option-button" onclick="showFAQ()">üí¨ Dudas frecuentes</button>
  `);
};

/* ================= DUDAS FRECUENTES ================= */
function showFAQ(){
  addMessage(`
    <strong>Dudas frecuentes</strong><br><br>
    Eleg√≠ el tema que quer√©s entender mejor üëá

    <button class="option-button" onclick="toggleBlock('faq1')">üß† ¬øQu√© es un plan de retiro y c√≥mo funciona?</button>
    <div id="faq1" class="info-block">
      Un plan de retiro es un ahorro de largo plazo regulado por la <strong>Superintendencia de Seguros de la Naci√≥n</strong>.<br><br>
      Funciona de forma simple y previsible:<br><br>
      1Ô∏è‚É£ Vos aport√°s todos los meses un monto que eleg√≠s.<br>
      2Ô∏è‚É£ Ese dinero se invierte y se capitaliza con el paso del tiempo.<br>
      3Ô∏è‚É£ Al llegar a la edad de retiro, cont√°s con un capital acumulado para complementar tu jubilaci√≥n.<br><br>
      No es un plazo fijo ni una inversi√≥n especulativa.<br>
      Est√° pensado para aprovechar el <strong>tiempo</strong>, que es el factor m√°s importante en este tipo de ahorro.
    </div>

    <button class="option-button" onclick="toggleBlock('faq2')">‚è≥ La importancia del tiempo (antes que el dinero)</button>
    <div id="faq2" class="info-block">
      En los planes de retiro, el <strong>tiempo</strong> es m√°s importante que el monto inicial.<br><br>
      Aportar un poco durante muchos a√±os suele generar m√°s capital que aportar mucho durante pocos a√±os.<br><br>
      Esto sucede porque:<br>
      ‚Ä¢ El dinero se capitaliza mes a mes.<br>
      ‚Ä¢ Los intereses se reinvierten.<br>
      ‚Ä¢ Cada a√±o adicional potencia al anterior.<br><br>
      Por eso, empezar antes ‚Äîaunque sea con un aporte moderado‚Äî suele marcar una gran diferencia en el resultado final.
    </div>

    <button class="option-button" onclick="toggleBlock('faq3')">üîÑ Flexibilidad de aportes</button>
    <div id="faq3" class="info-block">
      Uno de los puntos m√°s fuertes de los planes de retiro es la <strong>flexibilidad</strong>.<br><br>
      A lo largo del tiempo pod√©s:<br>
      ‚Ä¢ Subir tu aporte cuando tus ingresos mejoran.<br>
      ‚Ä¢ Bajarlo si atraves√°s un per√≠odo m√°s ajustado.<br>
      ‚Ä¢ Pausar aportes por un tiempo sin perder lo ya acumulado.<br>
      ‚Ä¢ Hacer aportes extraordinarios cuando te convenga.<br><br>
      El plan se adapta a tu realidad, no al rev√©s.
    </div>

    <button class="option-button" onclick="toggleBlock('faq4')">üßò‚Äç‚ôÇÔ∏è ¬øQu√© pasa si no puedo pagar por un tiempo?</button>
    <div id="faq4" class="info-block">
      Es una situaci√≥n com√∫n y est√° contemplada en este tipo de planes.<br><br>
      Si en alg√∫n momento no pod√©s pagar:<br>
      ‚Ä¢ Pod√©s reducir el aporte.<br>
      ‚Ä¢ Pod√©s pausar los aportes por un per√≠odo.<br>
      ‚Ä¢ El capital ya acumulado sigue siendo <strong>tuyo</strong>.<br><br>
      No perd√©s el plan ni lo construido hasta ese momento.
    </div>

    <button class="option-button" onclick="toggleBlock('faq5')">üí∞ Rescates: ¬øse puede retirar dinero antes?</button>
    <div id="faq5" class="info-block">
      Los planes de retiro permiten rescates anticipados, pero est√°n pensados para el largo plazo.<br><br>
      Por eso, los rescates pueden tener ajustes que dependen de:<br>
      ‚Ä¢ El momento en que se realicen.<br>
      ‚Ä¢ El tiempo que lleve el plan.<br>
      ‚Ä¢ Las condiciones espec√≠ficas de la p√≥liza.<br><br>
      No es una cuenta corriente: es un ahorro con objetivo.
    </div>
  `);
}

/* ================= SIMULADOR ================= */
let flow={step:0};

function startSimulation(){
  flow={step:1};
  addMessage("Perfecto üòä Para empezar, ¬øcu√°l es tu sexo? (M/F)");
}

async function sendMessage(){
  const i=document.getElementById("userInput");
  const t=i.value.trim();
  if(!t) return;
  addMessage(t,"user");
  i.value="";
  handleFlow(t);
}

async function handleFlow(msg){
  if(flow.step===1){ flow.sexo=msg.toUpperCase(); flow.step=2; return addMessage("¬øCu√°l es tu edad actual?"); }
  if(flow.step===2){ flow.edad=Number(msg); flow.step=3; return addMessage("¬øA qu√© edad te gustar√≠a retirarte?"); }
  if(flow.step===3){ flow.retiro=Number(msg); flow.step=4; return addMessage("¬øCu√°nto quer√©s aportar por mes?"); }
  if(flow.step===4){ flow.aporte=Number(msg); flow.step=0; runSimulation(); }
}

async function runSimulation(){
  addMessage("Calculando tu simulaci√≥n... ‚è≥");

  const r=await fetch("https://retirex.onrender.com/cotizar",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      sexo:flow.sexo,
      edad_actual:flow.edad,
      edad_retiro:flow.retiro,
      aporte_mensual:flow.aporte
    })
  });

  const data=await r.json();
  const oficial=data.oficial.capital;
  const realista=data.realista.capital;

  addMessage(`
    <strong>Resultados listos üéâ</strong><br><br>
    <strong>Escenario oficial:</strong><br>$${oficial.toLocaleString("es-AR")}<br><br>
    <strong>Escenario realista:</strong><br>$${realista.toLocaleString("es-AR")}<br><br>
    No ten√©s que elegir uno u otro: sirven para entender el rango posible de evoluci√≥n.
  `);

  const chartId="chart"+Date.now();
  addMessage(`
    <div class="chart-wrapper">
      <strong>Comparaci√≥n gr√°fica</strong><br><br>
      <canvas id="${chartId}" height="160"></canvas>
    </div>
  `);

  setTimeout(()=>{
    new Chart(document.getElementById(chartId),{
      type:"bar",
      data:{
        labels:["Oficial","Realista"],
        datasets:[{
          data:[oficial,realista],
          backgroundColor:["#a0005a","#004b9a"],
          borderRadius:10
        }]
      },
      options:{plugins:{legend:{display:false}}}
    });
  },200);

  addMessage(`
    <div style="font-size:12px;color:#666;">
      <strong>Importante:</strong> Esta es una simulaci√≥n orientativa.
      No constituye una oferta, contrato ni garant√≠a de rendimiento futuro.
    </div>
  `);

  <!-- BLOQUES POST-COTIZACI√ìN -->
  ${""}
  addMessage(`
    <strong>Antes de seguir, una breve gu√≠a para interpretar tu simulaci√≥n üëá</strong>

    <button class="option-button" onclick="toggleBlock('post1')">üß† C√≥mo leer estos resultados</button>
    <div id="post1" class="info-block">
      Esta simulaci√≥n muestra dos escenarios posibles porque un ahorro de largo plazo no se analiza con una sola cifra.
      El escenario oficial utiliza supuestos conservadores, mientras que el realista refleja una din√°mica m√°s cercana al largo plazo argentino.
    </div>

    <button class="option-button" onclick="toggleBlock('post2')">üõ°Ô∏è Qu√© tan seguro es este plan</button>
    <div id="post2" class="info-block">
      Es un plan de Prevenci√≥n Retiro ‚Äì Grupo Sancor Seguros, regulado por la Superintendencia de Seguros de la Naci√≥n,
      con capitalizaci√≥n individual y rendimiento t√©cnico garantizado del 4 % anual en pesos.
    </div>

    <button class="option-button" onclick="toggleBlock('post3')">üîÑ Qu√© pasa si mi situaci√≥n cambia</button>
    <div id="post3" class="info-block">
      Pod√©s ajustar, pausar o retomar aportes sin perder el capital acumulado.
      El plan se adapta a tu realidad.
    </div>
  `);

  const wsp=encodeURIComponent(
`Hola, quiero avanzar con mi plan de retiro.

Datos de mi simulaci√≥n:
Sexo: ${flow.sexo}
Edad actual: ${flow.edad}
Edad retiro: ${flow.retiro}
Aporte mensual: $${flow.aporte.toLocaleString("es-AR")}

Escenario oficial: $${oficial.toLocaleString("es-AR")}
Escenario realista: $${realista.toLocaleString("es-AR")}
`);

  addMessage(`
    <div class="cta-whatsapp">
      <a class="whatsapp-btn" href="https://wa.me/5492804866612?text=${wsp}" target="_blank">
        üì≤ Hablar con un asesor
      </a>
      <p class="privacidad">Sin spam. Solo asesoramiento real.</p>
    </div>
  `);
}
</script>
</body>
</html>
